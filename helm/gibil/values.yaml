common:
  app: gibil
  shortname: gibil
  team: ror
  ingress:
    trafficType: public
  container:
    image: <+artifacts.primary.image>
    imagePullPolicy: Always
    cpu: 2
    memory: 2560 # This is request mem. Limit is 20% higher.
    probes:
      enabled: true
      spec:
        startupProbe:
          tcpSocket:
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 1
          timeoutSeconds: 1
          failureThreshold: 300
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 45
          periodSeconds: 10
          timeoutSeconds: 10
          failureThreshold: 3
          successThreshold: 1
        livenessProbe:
          httpGet:
            path: /actuator/health/liveness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3

  initContainers:
    - name: extime-data-fetch
      image: <+artifacts.primary.image>
      securityContext:
        allowPrivilegeEscalation: false
        runAsNonRoot: true
        capabilities:
          drop: ["ALL"]
        seccompProfile:
          type: RuntimeDefault
      command:
        - sh
        - -c
        - |
          echo "Downloading zip file..."
          curl -o /tmp/rb_avi-aggregated-netex.zip https://storage.googleapis.com/marduk-production/outbound/netex/rb_avi-aggregated-netex.zip
          echo "Download complete. Extracting to input folder..."
          mkdir -p /app/input
          cd /app/input && jar xf /tmp/rb_avi-aggregated-netex.zip
          echo "Extraction complete. Cleaning up zip file..."
          rm /tmp/rb_avi-aggregated-netex.zip
          echo "Init container finished. Files in /app/input:"
          ls -la /app/input/
      resources:
        limits:
          cpu: 1
          memory: 512Mi
        requests:
          cpu: 0.5
          memory: 256Mi